<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Coding Contest</title>
    <link href="../img/CodeSpire_logo-04.png" rel="icon" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css"
      integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="register.css" />
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="./validate.js"></script>
  </head>
  <body onload="redirect()">
    <div class="container text-center" id="headContainer">
      <div class="row">
        <div class="col">
          <img src="../img/codespireFinalLogo.png" alt="logo" id="logo" />
        </div>

        <div class="col" id="regHead">Coding Contest</div>
      </div>
    </div>

    <div>
      <div id="glass2">
        <div class="container mb-5" id="regContainer">
          <form
            class="mb-2"
            id="coding-form"
            name="myForm"
            onsubmit="return validate()"
          >
            <div id="error-box" style="color: red"></div>
            <div class="FLName">
              <div class="mb-3">
              
                <label for="FName" class="form-label"
                  >First Name <span class="mandatory">*</span></label
                >
                <input
                  required
                  type="text"
                  class="form-control input-border"
                  id="FName"
                  name="firstName"
                  aria-describedby="emailHelp"
                  placeholder="First Name..."
                />
              </div>
              <div class="mb-3">
                <label for="LName" class="form-label"
                  >Last Name <span class="mandatory">*</span></label
                >
                <input
                  required
                  type="text"
                  class="form-control input-border"
                  id="LName"
                  name="lastName"
                  aria-describedby="emailHelp"
                  placeholder="Last Name..."
                />
              </div>
            </div>
            <div class="mb-3">
              <label for="Email" class="form-label"
                >Email (College mail preferred)
                <span class="mandatory">*</span></label
              >
              <input
                required
                type="email"
                class="form-control input-border"
                id="Email"
                name="email"
                aria-describedby="emailHelp"
                placeholder="Email..."
              />
            </div>
            <div class="mb-3">
              <label for="EnrollNum" class="form-label"
                >Enrollment Number (optional)</label
              >
              <input
                type="text"
                class="form-control input-border"
                id="EnrollNum"
                name="enrollment"
                aria-describedby="emailHelp"
                placeholder="Enrollment Number..."
              />
            </div>
            <div class="FLName">
              <div class="mb-3">
                <label for="ContactNo" class="form-label"
                  >Contact Number <span class="mandatory">*</span></label
                >
                <input
                  required
                  type="tel"
                  class="form-control input-border"
                  id="ContactNo"
                  name="contact"
                  aria-describedby="emailHelp"
                  placeholder="Contact Number..."
                />
              </div>
              <div class="mb-3">
                <label for="WhatsappNo" class="form-label"
                  >Whatsapp Number <span class="mandatory">*</span></label
                >
                <input
                  required
                  type="tel"
                  class="form-control input-border"
                  id="WhatsappNo"
                  name="whatsapp"
                  aria-describedby="emailHelp"
                  placeholder="Whatsapp Number..."
                />
              </div>
            </div>
            <div class="mb-3">
              <label for="College" class="form-label"
                >College Name <span class="mandatory">*</span></label
              >
              <input
                required
                type="text"
                class="form-control input-border"
                id="College"
                name="collegeName"
                aria-describedby="emailHelp"
                placeholder="College..."
              />
            </div>
            <div id="college-info" class="FLName">
              <div class="mb-3">
                <label for="Semester" class="form-label"
                  >Current Sem <span class="mandatory">*</span></label
                >
                <input
                  required
                  type="number"
                  class="form-control input-border"
                  id="Semester"
                  name="sem"
                  aria-describedby="emailHelp"
                  placeholder="Current Sem..."
                />
              </div>
              <div class="mb-3">
                <label for="CollegeCity" class="form-label"
                  >College City <span class="mandatory">*</span></label
                >
                <input
                  required
                  type="text"
                  class="form-control input-border"
                  id="CollegeCity"
                  name="collegeCity"
                  aria-describedby="emailHelp"
                  placeholder="College City..."
                />
              </div>
              <div class="mb-3">
                <label for="CollegeState" class="form-label"
                  >College State <span class="mandatory">*</span></label
                >
                <input
                  required
                  type="text"
                  class="form-control input-border"
                  id="CollegeState"
                  name="collegeState"
                  aria-describedby="emailHelp"
                  placeholder="College State..."
                />
              </div>
            </div>
            <!-- transaction details -->
            <div class="mb-3 teamDiv">
              <fieldset class="m-3" id="teamField">
                <legend>Transcation</legend>
                <div class="mb-3">
                  <label for="Lead" class="form-label member-name"
                    >Please fill transaction details before submitting the form.
                    <span class="mandatory">*</span><br />
                    <u> Registration Fee 20/- </u><br />
                    To visit our payment page scan the QR  or click <a href="https://aitr.feeszone.com/"><b>here</b></a>.
                  </label>
                  <div class="imageDiv">
                    <img src="./qrFinalImage.jpg" alt="QR Code" id="qrImage" />
                  </div>
                  <div class="mb-3">
                    <label for="TransactionID" class="form-label"
                      >Transaction ID <span class="mandatory">*</span></label
                    >
                    <input
                      required
                      type="text"
                      class="form-control input-border"
                      id="TransactionID"
                      name="transactionId"
                      aria-describedby="emailHelp"
                      placeholder="Transaction ID..."
                    />
                  </div>
                  <div class="mb-3">
                    <label for="TracsactionDate" class="form-label"
                      >Transaction Date <span class="mandatory">*</span></label
                    >
                    <input
                      required
                      type="date"
                      class="form-control input-border"
                      id="TransactionDate"
                      name="transactionDate"
                      aria-describedby="emailHelp"
                      placeholder="Transaction Date..."
                      min="2023-01-01"
                    />
                  </div>
                  <div class="mb-3">
                    Transaction Screenshot (max size : 2MB) 
                    <div class="input-group mb-3">
                      <div class="custom-file">
                        <input
                          name="transactionFile"
                          id="transactionFile"
                          
                          type="file"
                        />
                      </div>
                    </div>
                    <div id="file-error-box" style="color: red"></div>
                  </div><br />
                 

                  <label for="Lead" class="form-label Alternate-Method"
                  >If you face an issue during the payment, Please try again after some time, and If You still face any problems, then you can register at the link below, and our team will get back to you. 
                  <span class="mandatory">*</span><br>
                  <u> <a href="https://unstop.com/o/DnphRCz?lb=ETk43p6" class="Alternate-Method-Link"><br> https://unstop.com/o/DnphRCz?lb=ETk43p6</a> </u>
                </label>
                </div>
              </fieldset>
            </div>
            <button type="submit" class="btn btn-primary" id="subBut">
              Submit
            </button>
          </form>
        </div>
      </div>
    </div>
    <a href="./RegSuccess.html" style="display: none" id="success"></a>
  </body>
  <script>
    const { createClient } = supabase;
    supabase = createClient(
      "https://ybhhgnjefuaugxiooccc.supabase.co",
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InliaGhnbmplZnVhdWd4aW9vY2NjIiwicm9sZSI6ImFub24iLCJpYXQiOjE2NzI1MDY2MjMsImV4cCI6MTk4ODA4MjYyM30.zjOjI9OfTPHip-SvU2yvckVROkMuMNyYDxhFGE-XLf0"
    );
    const form = document.querySelector("#coding-form");
    form.addEventListener("submit", async (event) => {
      event.preventDefault();
      const formInputs = form.querySelectorAll("input");
      let submission = {};
      formInputs.forEach((element) => {
        const { value, name } = element;
        if (value) {
          submission[name] = value;
        }
      });
      if (!validate()) {
        submission[email] = null;
      }
      
      const { error } = await supabase.from("CodingUsers").insert(submission);

      if (error) {
        document.getElementById("error-box").innerHTML =
          "User already exists!!";
        document.getElementById("Email").focus();
        validate();
      } else {
        const { data, error1 } = await supabase.storage
        .from("cc-trans-img")
        .upload(
          `${submission["contact"]}_${formInputs[12].files[0].name}`,
          formInputs[12].files[0]
        );
        document.getElementById("success").click();
      }
      // console.log({ error });
      // console.log();
    });

    var uploadField = document.getElementById("transactionFile");

    uploadField.onchange = function () {
      if (this.files[0].size > 2097152) {
        document.getElementById("file-error-box").innerHTML =
          "File size too big!!";
          this.value = "";
      }
      else{
        document.getElementById("file-error-box").innerHTML =  " ";
      }
    };

    // function redirect() {
    //   window.location.href = "./RegClosed.html";
    // }
  </script>
</html>
